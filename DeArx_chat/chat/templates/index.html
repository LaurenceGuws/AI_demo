
<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div id="conversationsPane">
        <h2>Conversations</h2>
        <!-- Buttons will be added here dynamically -->
    </div>
    <div id="mainContent">
        <div id="chatbox">
            <h2>Chat</h2>
            <!-- ... rest of your HTML ... -->
        </div>
        <form id="messageForm">
            <textarea id="messageInput" placeholder="Type your message here..." rows="1"></textarea>
            <button type="submit">Send</button>
        </form>
        <div id="optionsPane">
            <button id="optionsButton">&#8942;</button>
            <div id="optionsDropdown">
                <a href="#" id="changeModel">Change AI Model</a>
                <a href="#" id="customInstructions">Custom Instructions</a>
                <a href="#" id="uploadLink">Upload a File</a>
            </div>
            <div id="modelsPopup" style="display: none;">
                <!-- Model options will be added here dynamically -->
            </div>            
        </div>
        <input type="file" id="fileUpload" style="display: none;">
        <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    </div>
    <script>
        $(document).ready(function() {
            $('#optionsButton').click(function(event) {
                event.stopPropagation();
                $('#optionsDropdown').toggle();
            });
            $(document).click(function() {
                $('#optionsDropdown').hide();
            });
            $('#uploadLink').click(function(event) {
                event.preventDefault();
                $('#fileUpload').click();
            });
            $("#changeModel").click(function(e) {
                e.preventDefault();
                $("#modelsPopup").toggle();
            });
            $('#fileUpload').change(function() {
                var formData = new FormData();
                formData.append('file', $(this)[0].files[0]);
                $.ajax({
                    url: '/upload',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        alert(response);
                        $('#fileUpload').val(''); // Clear the input
                    },
                    error: function(jqXHR, textStatus, errorMessage) {
                        alert('Error uploading: ' + errorMessage);
                    }
                });
            });
            // Fetch the model names from the server
            fetch('/get_models')
                .then(response => response.json())
                .then(models => {
                    // Generate the model options
                    const modelsPopup = $('#modelsPopup');
                    models.forEach(model => {
                        const modelOption = $('<a></a>').addClass('modelOption').attr('href', '#').text(model);
                        modelOption.click(function(e) {
                            e.preventDefault();
                            modelsPopup.hide();
                            $.post('/change_model', { model_name: model })
                                .done(function(response) {
                                    alert(response);
                                })
                                .fail(function() {
                                    alert('Error changing model');
                                });
                        });
                        modelsPopup.append(modelOption);
                    });
                });
        });
    </script>
</body>
</html>
