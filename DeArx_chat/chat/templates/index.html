<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div id="conversationsPane">
        <h2>Conversations</h2>
        <!-- Buttons will be added here dynamically -->
    </div>
    <div id="mainContent">
        <div id="chatbox">
            <h2>Chat</h2>
            <!-- ... rest of your HTML ... -->
        </div>
        <form id="messageForm">
            <textarea id="messageInput" placeholder="Type your message here..." rows="1"></textarea>
            <button type="submit">Send</button>
        </form>
        <div id="optionsPane">
            <button id="optionsButton">&#8942;</button>
            <div id="optionsDropdown">
                <a href="#" id="changeModel">Change AI Model</a>
                <a href="#" id="customInstructions">Custom Instructions</a>
                <a href="#" id="uploadLink">Upload a File</a>
            </div>
            <div id="modelsPopup" style="display: none;">
                <a href="#" class="modelOption">Model 1</a><br>
                <a href="#" class="modelOption">Model 2</a>
                <!-- More model options can go here -->
            </div>                    
        </div>
        <input type="file" id="fileUpload" style="display: none;">
        <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#optionsButton').click(function(event) {
                event.stopPropagation();
                $('#optionsDropdown').toggle();
            });
            $(document).click(function() {
                $('#optionsDropdown').hide();
            });
            $('#uploadLink').click(function(event) {
                event.preventDefault();
                $('#fileUpload').click();
            });
            $(document).ready(function() {
            $("#changeModel").click(function(e) {
                e.preventDefault();
                $("#modelsPopup").toggle();
            });
            });
            $(".modelOption").click(function(e) {
                e.preventDefault();
                
                // Get the chosen model name
                var modelName = $(this).text();

                // Send the model name to the backend
                $.ajax({
                    url: '/change_model',
                    type: 'POST',
                    data: { 'model_name': modelName },
                    success: function(response) {
                        alert(response);
                        $('#modelsPopup').hide();  // Hide the popup
                    },
                    error: function(jqXHR, textStatus, errorMessage) {
                        alert('Error changing model: ' + errorMessage);
                    }
                });
            });

            $('#fileUpload').change(function() {
                var formData = new FormData();
                formData.append('file', $(this)[0].files[0]);
                $.ajax({
                    url: '/upload',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        alert(response);
                        $('#fileUpload').val(''); // Clear the input
                    },
                    error: function(jqXHR, textStatus, errorMessage) {
                        alert('Error uploading: ' + errorMessage);
                    }
                });
            });
        });
    </script>
</body>
</html>
